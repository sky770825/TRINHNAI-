# Vercel 404 錯誤修復指南

## 錯誤訊息
```
404: NOT_FOUND
Code: `NOT_FOUND`
ID: `hkg1::5zmrd-1768133754625-2886b3070bfa`
```

## 問題原因

這個錯誤通常是因為 Vercel 無法正確處理 React SPA（單頁應用）的路由。當用戶直接訪問或刷新非根路徑（如 `/auth`、`/admin`）時，Vercel 會嘗試在伺服器端尋找這些檔案，但實際上這些路由應該由客戶端的 React Router 處理。

## 解決方案

### ✅ 已修復：簡化 vercel.json 配置

我已經將 `vercel.json` 簡化為只包含必要的 rewrites 配置：

```json
{
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

**為什麼移除其他配置？**
- `buildCommand`、`outputDirectory`、`framework`：Vercel 會自動檢測 Vite 專案，不需要手動指定
- `headers`：可以之後再加，先解決主要問題

### 下一步操作

1. **提交變更並重新部署**
   ```bash
   git add vercel.json
   git commit -m "Fix: Simplify Vercel config for SPA routing"
   git push
   ```

2. **或者在 Vercel Dashboard 重新部署**
   - 前往 [Deployments](https://vercel.com/linebot/trinhnai-342f2e80/deployments)
   - 點擊最新部署的 **⋯** → **Redeploy**

3. **測試路由**
   部署完成後，測試以下路由：
   - ✅ `https://trinhnai-342f2e80.vercel.app/` - 首頁
   - ✅ `https://trinhnai-342f2e80.vercel.app/auth` - 登入頁
   - ✅ `https://trinhnai-342f2e80.vercel.app/admin` - 管理頁（需要登入）
   - ✅ `https://trinhnai-342f2e80.vercel.app/crm` - CRM 頁（需要登入）

## 如何確認修復成功

### 方法 1：測試直接訪問路由
直接在瀏覽器訪問非根路徑：
- 如果不再顯示 404，而是顯示 React 應用內容 → ✅ 修復成功
- 如果仍然顯示 404 → 需要進一步檢查

### 方法 2：檢查部署日誌
1. 前往 [Vercel Deployments](https://vercel.com/linebot/trinhnai-342f2e80/deployments)
2. 查看最新的部署日誌
3. 確認建置成功且沒有錯誤

### 方法 3：檢查瀏覽器網路請求
1. 按 F12 開啟開發者工具
2. 前往 Network 標籤
3. 訪問一個路由（如 `/auth`）
4. 檢查 `index.html` 是否成功載入（應該是 200 狀態）

## 如果問題仍然存在

### 檢查 1：確認輸出目錄
在 Vercel Dashboard：
1. 前往 **Settings** → **General**
2. 確認 **Output Directory** 設為 `dist`（或留空讓 Vercel 自動檢測）

### 檢查 2：確認建置命令
在 Vercel Dashboard：
1. 前往 **Settings** → **General**
2. 確認 **Build Command** 設為 `npm run build`（或留空讓 Vercel 自動檢測）

### 檢查 3：查看建置日誌
1. 前往 **Deployments**
2. 點擊失敗的部署
3. 查看 **Build Logs**
4. 檢查是否有錯誤訊息

### 檢查 4：本地測試
確認本地建置正常：
```bash
npm run build
npm run preview
```
然後訪問 `http://localhost:4173/auth` 測試路由是否正常。

## 其他可能的問題

### 問題 A：靜態資源 404
如果 CSS、JS 檔案也出現 404，可能是 base path 問題。

**解決方法**：檢查 `vite.config.ts` 是否有設定 `base` 路徑。

### 問題 B：API 路由 404
如果 Supabase API 請求出現 404，這是正常的，因為這些請求應該發送到 Supabase，不是 Vercel。

### 問題 C：環境變數未設定
確保環境變數已正確設定（參考 `VERCEL_CHECKLIST.md`）。

## 參考資料

- [Vercel 404 錯誤指南](https://vercel.com/guides/why-is-my-deployed-project-giving-404)
- [Vite 部署指南](https://vitejs.dev/guide/static-deploy.html)
- [Vercel SPA 路由配置](https://vercel.com/docs/concepts/projects/project-configuration#rewrites)
